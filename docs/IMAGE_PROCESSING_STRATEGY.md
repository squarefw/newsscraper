# 图像处理与特色图片功能开发策略

## 🎯 核心目标
为AI处理后的新闻文章自动配备高质量、内容相关的图片，以提升文章的可读性和吸引力。最终目标是实现图文并茂的自动化内容发布。

##  phased实施方案
考虑到成本、复杂性和开发效率，我们采用分阶段的开发策略。

---

### 🔥 Phase 1: 提取并设置单张“特色图片” (当前正在开发)

#### 概述
此阶段的目标是快速解决文章“从无图到有图”的核心痛点。我们将从原文中智能识别并提取最重要的一张图片，并将其设置为WordPress文章的“特色图片”。

#### 技术实现
1.  **增强内容抓取 (`extractNewsFromUrl`)**:
    *   在抓取标题和正文的同时，增加逻辑以提取文章主图的URL。
    *   **提取优先级**:
        1.  `<meta property="og:image">` (Open Graph 标签，最准确)
        2.  `<meta name="twitter:image">` (Twitter Card 标签)
        3.  文章主要内容区域的第一张 `<img>` 标签。
    *   抓取函数将返回 `{ title, content, imageUrl }`。

2.  **增强WordPress连接器 (`wordpressConnector.js`)**:
    *   新增 `uploadImageFromUrl(imageUrl)` 方法。此方法负责：
        *   通过URL下载图片数据。
        *   使用WordPress REST API (`/wp-json/wp/v2/media`)将图片上传到媒体库。
        *   返回上传成功后的媒体ID (`mediaId`)。
    *   修改 `publishPost` 方法，使其接受一个可选的 `featuredMediaId` 参数。

3.  **更新发布流程 (`batch-ai-push.js`)**:
    *   在主流程中，调用 `extractNewsFromUrl` 后，检查是否成功获取 `imageUrl`。
    *   如果获取成功，调用 `wpConnector.uploadImageFromUrl(imageUrl)` 上传图片并获取 `mediaId`。
    *   调用 `pushToWordPressWithConnector` 时，将 `mediaId` 传递下去。
    *   在最终发布文章到WordPress时，将 `mediaId` 赋给文章的 `featured_media` 字段。

#### 优点
- **实现快，成本低**: 能以最小的开发代价快速见效。
- **效果显著**: “特色图片”能极大地改善文章在网站前台的展示效果。
- **性能可控**: 每篇文章只处理一张图片，对整体流程速度影响较小。

---

### 🚀 Phase 2: AI智能筛选多张相关图片 (未来计划)

#### 概述
在Phase 1的基础上，开发一个高级功能，利用多模态AI模型筛选出所有与文章内容相关的图片，实现真正的图文并茂。

#### 技术实现
1.  **全面图片提取**: 修改抓取脚本，提取文章正文中所有候选图片的URL和`alt`文本。

2.  **AI相关性分析 (核心)**:
    *   对于每一张候选图片，调用一个多模态AI模型 (如 GPT-4o, Gemini)。
    *   将文章的**标题/摘要**和**图片URL**同时发送给AI。
    *   向AI提问：“这张图片是否与新闻内容强相关？”，并获取“是/否”的回答。

3.  **相关图片处理**:
    *   只下载并上传AI判断为“是”的图片到WordPress媒体库。
    *   获取每张图片上传后的新URL。
    *   在最终的文章HTML内容中，将这些图片的旧URL替换为新URL。

4.  **智能设置特色图片**:
    *   从所有上传成功的相关图片中，选择第一张或尺寸最大的一张，将其`mediaId`设置为文章的“特色图片”。

5.  **配置化策略**:
    *   在配置文件中增加一个开关，如 `imageProcessingStrategy`。
    *   允许用户选择 `'featured'` (快速单图模式) 或 `'ai_multi_select'` (高质量多图模式)。

#### 优点
- **内容质量极高**: 确保所有配图都与文章内容相关。
- **自动过滤噪音**: 自动移除广告、Logo等无关图片。
- **最佳阅读体验**: 实现真正的图文并茂。

#### 需要权衡的代价
- **成本显著增加**: 多模态AI的调用费用远高于纯文本AI。
- **速度变慢**: 多次AI调用和图片上传会大幅增加处理时间。
- **实现复杂度高**: 需要处理复杂的HTML解析、替换和健壮的错误处理。

---

通过这种分阶段的方式，我们可以稳步推进，在控制成本和风险的同时，最终实现高质量的自动化内容发布系统。
